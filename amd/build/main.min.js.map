{"version":3,"sources":["../src/main.js"],"names":["_perPageCount","_page","_lang","_courseId","populateStrings","Str","get_strings","key","component","then","results","getEnrolmentBlockData","page","addLoader","ajax","call","methodname","args","courseid","perpage","sortdir","done","data","length","Templates","renderForPromise","users","html","js","replaceNodeContents","pagination","removeLoader","catch","handleError","fail","loadUserModal","e","preventDefault","clickedLink","currentTarget","userid","addClass","loaderAdded","loadingicon","addIconToContainerWithPromise","studentid","ModalFactory","create","title","get_string","body","render","user","modal","show","loadUserPagination","_hrefTarget","target","is","attr","closest","handlers","getParameterByName","remove","resolve","removeClass","Notifications","alert","init","on"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport $ from 'jquery';\nimport loadingicon from \"core/loadingicon\";\nimport ModalFactory from 'core/modal_factory';\nimport handlers from 'block_enrol_student/handlers';\nimport Notifications from 'core/notification';\nimport * as Str from 'core/str';\n\nexport let _perPageCount = 25;\nexport let _page = 0;\nexport let _lang = [];\nexport let _courseId = null;\nexport let _sortOrder = 'ASC';\n\n\n/**\n * Populate string for the messages\n * @method\n */\nexport const populateStrings = () => {\n    var strings = [\n        {\n            key: 'error_title',\n            component: 'block_enrol_student'\n        },\n        {\n            key: 'block_enrol_student_load_error',\n            component: 'block_enrol_student'\n        },\n    ];\n\n    // eslint-disable-next-line promise/catch-or-return\n    Str.get_strings(strings).then(function (results) {\n        _lang = results;\n    });\n};\n\n/**\n * Get Enrolment Block Data\n * @param page\n * @param addLoader\n */\nexport const getEnrolmentBlockData = function (page, addLoader) {\n    ajax.call([{\n        methodname: 'block_enrol_student_enrol_student_data',\n        args: {\n            courseid: _courseId,\n            perpage: _perPageCount,\n            page: page,\n            sortdir: _sortOrder,\n        },\n        done: function (data) {\n            if (data.data.length > 0) {\n                Templates.renderForPromise(\n                    'block_enrol_student/table/users',\n                    {\n                        users: data.data\n                    }\n                ).then(({html, js}) => {\n                    Templates.replaceNodeContents('.enrol-student-container>tbody', html, js);\n                    if (data.pagination !== '') {\n                        $('.student-block-pagination').html(data.pagination);\n                    } else {\n                        $('student-block-pagination').html('');\n                    }\n                    removeLoader(addLoader);\n                }).catch(\n                    () => handleError(addLoader, _lang[1])\n                );\n            } else {\n                removeLoader(addLoader);\n            }\n\n        },\n        fail: function () {\n            handleError(addLoader, _lang[1]);\n        }\n    }]);\n};\n\n/**\n * Load User Modal\n * @param e\n */\nexport const loadUserModal = (e) => {\n    e.preventDefault();\n    var clickedLink = $(e.currentTarget);\n    var userid = clickedLink.data('id');\n    $('.enrol-student-container').addClass('loading');\n    var loaderAdded = loadingicon.addIconToContainerWithPromise($('.enrol-student-container'));\n\n    ajax.call([{\n        methodname: 'block_enrol_student_get_student_data',\n        args: {\n            studentid: userid\n        },\n        done: function (data) {\n            ModalFactory.create({\n                title: Str.get_string('enrol_student:title', 'block_enrol_student'),\n                body: Templates.render('block_enrol_student/modal/user', {user: data.data}),\n            })\n                .then(function (modal) {\n                    modal.show();\n                    removeLoader(loaderAdded);\n                });\n        },\n        fail: function () {\n            handleError(loaderAdded, _lang[1]);\n        }\n    }]);\n};\n\n/**\n *  Load User Pagination\n *  @method\n *  @param e\n */\nexport const loadUserPagination = (e) => {\n    e.preventDefault();\n    let _hrefTarget = $(e.target).is('a') ? $(e.target).attr('href') : $(e.target).closest('a').attr('href');\n    _page = handlers.getParameterByName('page', _hrefTarget);\n    getEnrolmentBlockData(_page, addLoader());\n};\n\n/**\n * Adds a loader to the screen whenever called\n *\n * @method\n * @returns {Window.jQuery|Promise|*}\n */\nexport const addLoader = () => {\n    $('.enrol-student-container').addClass('loading');\n    return loadingicon.addIconToContainerWithPromise($('.enrol-student-container'));\n};\n\n/**\n * Removes the previously added loader from the screen\n *\n * @method\n * @param loaderAdded {object} added loader to the dom\n */\nexport const removeLoader = (loaderAdded) => {\n    $('.loading-icon').remove();\n    loaderAdded.resolve();\n    $('.enrol-student-container').removeClass('loading');\n};\n\n/**\n * Display exception message in a notification\n *\n * @method\n * @param loaderAdded {object} added loaded to the dom\n * @param body {string} the message string for the popup\n */\nexport const handleError = (loaderAdded, body) => {\n    removeLoader(loaderAdded);\n    Notifications.alert(_lang[0], body);\n};\n\n/**\n * Initialize the main js and register events\n * @method\n * @param courseid\n * @param perpage\n */\nexport const init = (courseid, perpage) => {\n    _courseId = courseid;\n    _perPageCount = perpage;\n\n    populateStrings();\n    getEnrolmentBlockData(0, addLoader());\n    $(\".enrol-student-container\").on('click', '#user_id', (e) => loadUserModal(e));\n    $('.student-block-pagination').on('click', 'ul.pagination li>a', (e) => loadUserPagination(e));\n};"],"file":"main.min.js"}