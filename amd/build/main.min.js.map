{"version":3,"sources":["../src/main.js"],"names":["_perPageCount","_page","_lang","_courseId","init","courseid","perpage","populateStrings","getEnrolmentBlockData","addLoader","on","e","loadUserModal","loadUserPagination","Str","get_strings","key","component","then","results","page","ajax","call","methodname","args","sortdir","done","data","length","Templates","renderForPromise","users","html","js","replaceNodeContents","pagination","removeLoader","catch","handleError","fail","preventDefault","_userId","target","is","closest","_firstName","_lastName","_fullName","ModalFactory","create","title","body","modal","show","_hrefTarget","attr","handlers","getParameterByName","addClass","loadingicon","addIconToContainerWithPromise","loaderAdded","remove","resolve","removeClass","Notifications","alert"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport ajax from  'core/ajax';\nimport Templates from  'core/templates';\nimport $ from 'jquery';\nimport loadingicon from \"core/loadingicon\";\nimport ModalFactory  from 'core/modal_factory';\nimport handlers from 'block_enrol_student/handlers';\nimport Notifications from 'core/notification';\nimport * as Str from 'core/str';\n\nexport let _perPageCount = 25;\nexport let _page = 0;\nexport let _lang = [];\nexport let _courseId = null;\nexport let _sortOrder = 'ASC';\n\n/**\n * Initialize the main js and register events\n * @method\n * @param courseid\n * @param perpage\n */\nexport const init = (courseid,perpage) => {\n    _courseId = courseid;\n    _perPageCount = perpage;\n\n    populateStrings();\n    getEnrolmentBlockData(0,addLoader());\n    $(\".enrol-student-container\").on('click', '#user_id', (e) => loadUserModal(e));\n    $('.student-block-pagination').on('click', 'ul.pagination li>a', (e) => loadUserPagination(e));\n};\n\n/**\n * Populate string for the messages\n * @method\n */\nexport const populateStrings = () => {\n    var strings = [\n        {\n            key: 'error_title',\n            component: 'block_enrol_student'\n        },\n        {\n            key: 'block_enrol_student_load_error',\n            component: 'block_enrol_student'\n        },\n    ];\n\n    // eslint-disable-next-line promise/catch-or-return\n    Str.get_strings(strings).then(function(results) {\n        _lang = results;\n    });\n};\n\n/**\n * Get Enrolment Block Data\n * @param page\n */\nexport const getEnrolmentBlockData = function (page, addLoader) {\n    ajax.call([{\n        methodname: 'block_enrol_student_enrol_student_data',\n        args: {\n            courseid: _courseId,\n            perpage: _perPageCount,\n            page: page,\n            sortdir: _sortOrder,\n        },\n        done: function (data) {\n            if (data.data.length > 0) {\n                Templates.renderForPromise(\n                    'block_enrol_student/table/users',\n                    {\n                        users: data.data\n                    }\n                ).then(({html, js}) => {\n                    Templates.replaceNodeContents('.enrol-student-container>tbody', html, js);\n                    if (data.pagination !== '') {\n                        $('.student-block-pagination').html(data.pagination);\n                    } else {\n                        $('student-block-pagination').html('');\n                    }\n                    removeLoader(addLoader);\n                }).catch(\n                    () => handleError(addLoader, _lang[1])\n                );\n            } else {\n                removeLoader(addLoader);\n            }\n\n        },\n        fail: function () {\n            handleError(addLoader, _lang[1]);\n        }\n    }]);\n};\n\n/**\n * Load User Modal\n * @param e\n */\nexport const loadUserModal = (e) => {\n    // Use API.\n    e.preventDefault();\n    let _userId = $(e.target).is('a') ? $(\"#user_id\").data('id') : $(e.target).closest('a').data('id');\n    let _firstName = $(e.target).is('a') ? $(\"#user_id\").data('firstname') : $(e.target).closest('a').data('firstname');\n    let _lastName = $(e.target).is('a') ? $(\"#user_id\").data('lastname') : $(e.target).closest('a').data('lastname');\n    let _fullName = $(e.target).is('a') ? $(\"#user_id\").data('fullname') : $(e.target).closest('a').data('fullname');\n\n    // Create Modal Factory.\n    ModalFactory.create({\n        title: 'Student Information',\n        body: \"       <table>\\n\" +\n            \"            <tr>\\n\" +\n            \"                <th>ID</th>\\n\" +\n            \"                <th>FIRST NAME</th>\\n\" +\n            \"                <th>LAST NAME</th>\\n\" +\n            \"                <th>FULL NAME</th>\\n\" +\n            \"            </tr>\\n\" +\n            \"            <tbody>\\n\" +\n            \"\\n\" +\n            \"            <tr>\\n\" +\n            \"                <td>\" +\n            _userId +\n            \"</td>\\n\" +\n            \"                <td>\" +\n            _firstName +\n            \"</td>\\n\" +\n            \"                <td>\" +\n            _lastName +\n            \"</td>\\n\" +\n            \"                <td>\" +\n            _fullName +\n            \"</td>\\n\" +\n            \"\\n\" +\n            \"            </tr>\\n\" +\n            \"\\n\" +\n            \"            </tbody>\\n\" +\n            \"        </table>\",\n    })\n        .done(function (modal) {\n            modal.show();\n        });\n\n};\n\n/**\n *  Load User Pagination\n *  @method\n *  @param e\n */\nexport const loadUserPagination = (e) => {\n    e.preventDefault();\n    let _hrefTarget = $(e.target).is('a') ? $(e.target).attr('href') : $(e.target).closest('a').attr('href');\n    _page = handlers.getParameterByName('page', _hrefTarget);\n    getEnrolmentBlockData(_page, addLoader());\n};\n\n/**\n * Adds a loader to the screen whenever called\n *\n * @method\n * @returns {Window.jQuery|Promise|*}\n */\nexport const addLoader = () => {\n    $('.enrol-student-container').addClass('loading');\n    return loadingicon.addIconToContainerWithPromise($('.enrol-student-container'));\n};\n\n/**\n * Removes the previously added loader from the screen\n *\n * @method\n * @param loaderAdded {object} added loader to the dom\n */\nexport const removeLoader = (loaderAdded) => {\n    $('.loading-icon').remove();\n    loaderAdded.resolve();\n    $('.enrol-student-container').removeClass('loading');\n};\n\n/**\n * Display exception message in a notification\n *\n * @method\n * @param loaderAdded {object} added loaded to the dom\n * @param body {string} the message string for the popup\n */\nexport const handleError =  (loaderAdded, body) => {\n    removeLoader(loaderAdded);\n    Notifications.alert(_lang[0], body);\n};"],"file":"main.min.js"}